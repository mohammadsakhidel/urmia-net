$(function () {
    // event handlers:
    $('.chat_dlg_newmsg textarea').live('keypress', function (event) {
        if (event.keyCode == 13 && !event.shiftKey) {
            if ($.trim($(this).val()).length > 0) {
                var form = $(this).parent();
                form.submit();
                $(this).val('');
            }
            return false;
        }
    });
});

function SendChatMessageFailure() {
    show_error_dialog('fail');
}

function SendChatMessageSuccess(data) {
    if (data.Done) {
        $('div.chat_dlg_msgs_in').append(data.PartialView);
        scroll_down_chat_msgs();
    }
    else {
        show_error_dialog(data.Errors[0]);
    }
}

function submit_view_older_msgs_form() {
    $('div.chat_dlg_msgs form#frm_view_older_msgs').submit();
}

function GetOlderChatMessagesBegin() {
    $('div.chat_dlg_msgs a#view_older_msgs').addClass("view_older_msgs_inprogress");
}

function GetOlderChatMessagesFailure(data) {
    var msg = $('div.chat_dlg_msgs #chat_dlg_w_ajax_fail').val();
    show_error_dialog(msg);
}

function GetOlderChatMessagesSuccess(data) {
    if (data.Done) {
        $('div.chat_dlg_msgs_in').prepend(data.PartialView);
        if (!data.IsMore) {
            $('a.view_older_msgs').remove();
        }
        else {
            $('form#frm_view_older_msgs input[name="olderThanDate"]').val(data.OldestMessageDate);
        }
        scroll_up_chat_msgs
    }
    else {
        show_error_dialog(data.Errors[0]);
    }
}

function GetOlderChatMessagesComplete(data) {
    $('div.chat_dlg_msgs a#view_older_msgs').removeClass("view_older_msgs_inprogress");
}