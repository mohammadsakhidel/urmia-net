function AddPostBegin() {
    $('#post_editor #post_message').hide();
}

function AddPostFailure() {
    $('#post_editor #post_message').removeClass('success_message').addClass('error_message').html($('#w_ajax_fail').val()).fadeIn('fast');
}

function AddPostSuccess(data) {
    if (data.Done) {
        clear_editor();
        $('#post_editor #post_message').removeClass('error_message').addClass('success_message').html(data.Message).fadeIn('fast');
        $('#' + $('#hid_pe_update_panel_id').val()).prepend(data.PartialView);
        //scroll_top();
    }
    else {
        $('#post_editor #post_message').removeClass('success_message').addClass('error_message').html(data.Errors[0]).fadeIn('fast');
    }
}

function clear_editor() {
    $('#post_editor #upload_progress').hide();
    $('#post_editor #post_message').hide();
    $('#post_editor #post_txt').val("");
    $('#post_editor #post_txt').height(60);
    $('#post_editor select#VisibleTo').val(3);
    $('#post_editor #uploaded_files div').each(function () {
        remove_attached_file($(this).attr('id'));
    });
    //clear tags:
    $('#post_editor input#post_tags').val('');
    var addedTagsTxt = $('input[name="AddedTags"]').val();
    var tags = split(addedTagsTxt, ';');
    for (var i = 0; i < tags.length; i++) {
        remove_tag(tags[i]);
    }
}

function post_tags_key_down(e) {
    if (e.keyCode == 13) {
        var txt = $('input#post_tags').val();
        if ($.trim(txt).length > 0) {
            add_tag(txt);
        }
        return false;
    }
}

function add_tag(txt) {
    if (!tag_exists(txt)) {
        var splitter = ';';
        var addedTags = $('input[name="AddedTags"]').val();
        var toAdd = split(txt, ';');
        for (var i = 0; i < toAdd.length; i++) {
            addedTags += toAdd[i] + ';';
            $('#post_added_tags').append('<a class="tag post_editor_tag"><span>' + toAdd[i] + '</span></a>');
        }
        $('input[name="AddedTags"]').val(addedTags);
    }
    setTimeout(function () {
        $('input#post_tags').val('');
    }, 100);
}

function remove_tag(txt) {
    var newTagList = '';
    $('#post_added_tags .tag').each(function () {
        var tag = $(this).find('span').html();
        if (tag == txt) {
            $(this).remove();
        }
        else {
            newTagList += tag + ';';
        }
    });
    $('input[name="AddedTags"]').val(newTagList);
}

function tag_exists(txt) {
    var res = false;
    var addedTagsTxt = $('input[name="AddedTags"]').val();
    var tags = split(addedTagsTxt, ';');
    for (var i = 0; i < tags.length; i++) {
        if (tags[i] == txt)
            res = true;
    }
    return res;
}